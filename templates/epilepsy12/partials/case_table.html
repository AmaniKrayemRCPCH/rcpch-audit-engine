{% load epilepsy12_template_tags %}
<div hx-target='#case_table' hx-get="{% url 'cases' hospital_id=hospital_trust.pk %}" hx-trigger='case_list from:body'
  hx-swap='innerHTML' name='case_table'>
  {% if case_list.end_index > 0 %}
  <table class="ui rcpch table">
    <thead>
      <tr>
        {% comment %}
        <th>ID
          {% if sort_flag and sort_flag == "sort_by_id_down" %}
          <i class="sort icon" id="sort_button" name="sort_by_id_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_id_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% elif sort_flag and sort_flag == "sort_by_id_up" %}
          <i class="sort icon" id="sort_button" name="sort_by_id_down" hx-target="#case_table"
            hx-get="{% url 'sort_by_id_down' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% else %}
          <i class="sort icon" id="sort_button" name="sort_by_id_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_id_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% endif %}
        </th>
        {% endcomment %}
        <th>Name
          {% if sort_flag and sort_flag == "sort_by_name_down" %}
          <i class="sort icon" id="sort_button" name="sort_by_name_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_name_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% elif sort_flag and sort_flag == "sort_by_name_up" %}
          <i class="sort icon" id="sort_button" name="sort_by_name_down" hx-target="#case_table"
            hx-get="{% url 'sort_by_name_down' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% else %}
          <i class="sort icon" id="sort_button" name="sort_by_name_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_name_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% endif %}
        </th>
        <th>Sex
          {% if sort_flag and sort_flag == "sort_by_sex_down" %}
          <i class="sort icon" id="sort_button" name="sort_by_sex_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_sex_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% elif sort_flag and sort_flag == "sort_by_sex_up" %}
          <i class="sort icon" id="sort_button" name="sort_by_sex_down" hx-target="#case_table"
            hx-get="{% url 'sort_by_sex_down' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% else %}
          <i class="sort icon" id="sort_button" name="sort_by_sex_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_sex_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% endif %}
        </th>
        <th>NHS Number
          {% if sort_flag and sort_flag == "sort_by_nhs_number_down" %}
          <i class="sort icon" id="sort_button" name="sort_by_nhs_number_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_nhs_number_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% elif sort_flag and sort_flag == "sort_by_nhs_number_up" %}
          <i class="sort icon" id="sort_button" name="sort_by_nhs_number_down" hx-target="#case_table"
            hx-get="{% url 'sort_by_nhs_number_down' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% else %}
          <i class="sort icon" id="sort_button" name="sort_by_nhs_number_up" hx-target="#case_table"
            hx-get="{% url 'sort_by_nhs_number_up' hospital_id=hospital_trust.pk %}" hx-trigger="click"></i>
          {% endif %}
        </th>
        <th>Deadline</th>
        <th>Cohort</th>
        <th>Days remaining</th>
        <th class='two wide'></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for case in case_list %}
        {%if case.locked %}
          <tr class='disabled'>
        {% else %}
          {% if case.registration.days_remaining_before_submission < 7 and  case.registration.days_remaining_before_submission > 0 %}
            <tr class='imminent'>
          {% elif case.registration.days_remaining_before_submission == 0 %}
              <tr class='closed disabled'>
          {% else %}
              <tr>
          {% endif %}
        {% endif %}
          <td>{% none_masked case.first_name %} {% none_masked case.surname %}</td>
          <td>{% none_masked case.get_sex_display %}</td>
          <td>{% none_masked case.nhs_number %}</td>
          <td>{% none_masked case.registration.audit_submission_date|date:'D j M Y' %}</td>
          <td>{% if case.registration.cohort is not None %}{{ case.registration.cohort }}{% endif %}</td>
          <td>{% if case.registration.days_remaining_before_submission is not None %}{{ case.registration.days_remaining_before_submission }}{% endif %}</td>
          <td class='two wide'>
            <div class='ui buttons'>
              <button data-tooltip='Edit child details.' class="ui rcpch_primary icon button" tabindexed="0" {% if case.locked %}disabled{% endif %}><a href="{% url 'update_case' hospital_id=hospital_id case_id=case.id%}" {% if case.locked %}disabled{% endif %}><i
                class="edit outline icon"></i></a></button>
              <button data-tooltip='Delete Child. This is irreversible.' class="ui rcpch_danger icon button" tabindexed="1" {% if case.locked %}disabled{% endif %}><a href="{% url 'delete_case' hospital_id=hospital_id case_id=case.id%}"><i
                class="trash alternate outline icon"></i></a></button>
              {% if case.registration.registration_date %}
                {% if case.locked %}
                <button data-tooltip='Complete audit details.'class="ui rcpch_positive button" tabindexed="2" disabled
                onclick="location.href='{% url 'register'  case.id %}'">Enter Data</button>
                {% else %}
                <button data-tooltip='Complete audit details.'class="ui rcpch_positive button" tabindexed="2"
                onclick="location.href='{% url 'register'  case.id %}'">Enter Data</button>
                {% endif %}
              {% else %}
                {% if case.locked %}
                <button class="ui rcpch_primary button" tabindexed="2" disabled
                onclick="location.href='{% url 'register' case_id=case.id %}'">Register</button>
                {% else %}
                <button class="ui rcpch_primary button" tabindexed="2"
                onclick="location.href='{% url 'register' case_id=case.id %}'">Register</button>
                {% endif %}
              {% endif %}
            </div>
          </td>
          <td><button data-tooltip='Opt out of Epilepsy12' class="ui rcpch_danger icon button" tabindexed="1" {% if case.locked %}disabled{% endif %}><a href="{% url 'opt_out' hospital_id=hospital_id case_id=case.id%}" {% if case.locked %}disabled{% endif %}><i
            class="sign-out icon"></i></a></button></td>
        </tr>

      {% endfor %}

    <tfoot>
      <tr>
        <th colspan="10" class="right aligned">
          {% if case_list.has_previous %}
          <div class="ui rcpch_primary button" hx-target="#case_table"
            hx-get="{% url 'cases' hospital_id=hospital_trust.pk %}?page={{case_list.previous_page_number}}&sort_flag={{sort_flag}}"
            hx-swap="innerHTML">Previous 10</div>
          {% endif %}
          {% if case_list.has_next %}
          <div class="ui rcpch_primary button" name="next_button" hx-target="#case_table"
            hx-get="{% url 'cases' hospital_id=hospital_trust.pk  %}?page={{case_list.next_page_number}}&sort_flag={{sort_flag}}"
            hx-swap="innerHTML">Next 10</div>
          {% endif %}
        </th>
      </tr>
    </tfoot>

    </tbody>
  </table>
  {% else %}
  <div class='ui container'>
    <div class='padded_container'>
      <div class='ui rcpch_info message'>There are no children registered yet</div>
    </div>
  </div>
  {% endif %}
</div>